-- CREATE TABLE IF NOT EXISTS hopital (
--     codehopital INT PRIMARY KEY,
--     nomhopital VARCHAR (255),
--     adressehopital VARCHAR (255)
-- );
-- INSERT INTO hopital VALUES(1, 'hopital1', 'adresse1');
-- INSERT INTO hopital VALUES(2, 'hopital2', 'adresse2');
-- INSERT INTO hopital VALUES(3, 'hopital3', 'adresse3');

-- CREATE TABLE IF NOT EXISTS laboratoire (
--     codelaboratoire INT PRIMARY KEY,
--     nomlaboratoire VARCHAR (255),
--     codehopital INT,
--     FOREIGN KEY (codehopital) REFERENCES hopital(codehopital)
-- );
-- INSERT INTO laboratoire VALUES(1, 'lab1', 1);
-- INSERT INTO laboratoire VALUES(2, 'lab2', 2);
-- INSERT INTO laboratoire VALUES(3, 'lab3', 3);

-- CREATE TABLE IF NOT EXISTS service (
--     codeservice INT PRIMARY KEY,
--     nomservice VARCHAR (255),
--     codehopital INT,
--     FOREIGN KEY (codehopital) REFERENCES hopital(codehopital)
-- );
-- INSERT INTO service VALUES(1, 'service1', 1);
-- INSERT INTO service VALUES(2, 'service2', 2);
-- INSERT INTO service VALUES(3, 'service3', 3);

-- CREATE TABLE IF NOT EXISTS medecin (
--     nummatricule INT PRIMARY KEY,
--     nommedecin VARCHAR (255),
--     specialitemedecin VARCHAR (255),
--     fonctionmedecin VARCHAR (255),
--     salaire INT,
--     codehopital INT,
--     codelaboratoire INT,
--     codeservice INT,
--     FOREIGN KEY (codehopital) REFERENCES hopital(codehopital),
--     FOREIGN KEY (codelaboratoire) REFERENCES laboratoire(codelaboratoire),
--     FOREIGN KEY (codeservice) REFERENCES service(codeservice)
-- );
-- INSERT INTO medecin VALUES(20120600, 'medecin1', 'gynecologie', 'chercheur', 20, 1, 1, 1);
-- INSERT INTO medecin VALUES(30230700, 'medecin2', 'cardiologie', 'chercheur', 40, 2, 2, 2);
-- INSERT INTO medecin VALUES(40340800, 'medecin3', 'cardiologie', 'practicien', 10, 3, 3, 3);

-- CREATE TABLE IF NOT EXISTS patient (
--     numsecsoc INT PRIMARY KEY,
--     nompatient VARCHAR (255),
--     prenompatient VARCHAR (255),
--     adressepatient VARCHAR (255),
--     datedenaissancepatient INT
-- );
-- INSERT INTO patient VALUES(12, 'nom1', 'prenom1', 'adpat1', 1999);
-- INSERT INTO patient VALUES(34, 'nom2', 'prenom2', 'adpat2', 2000);
-- INSERT INTO patient VALUES(56, 'nom3', 'prenom3', 'adpat3', 2001);

-- CREATE TABLE IF NOT EXISTS consulter (
--     nummatricule INT,
--     numsecsoc INT,
--     PRIMARY KEY (nummatricule, numsecsoc),
--     FOREIGN KEY (nummatricule) REFERENCES medecin(nummatricule),
--     FOREIGN KEY (numsecsoc) REFERENCES patient(numsecsoc)
-- );
-- INSERT INTO consulter VALUES(20120600, 12);
-- INSERT INTO consulter VALUES(30230700, 34);
-- INSERT INTO consulter VALUES(40340800, 56);

-- a)
WITH med AS (SELECT numsecsoc, codehopital
             FROM medecin NATURAL JOIN consulter
             WHERE specialitemedecin = 'gynecologie')
SELECT nompatient, nomhopital
FROM patient NATURAL JOIN hopital NATURAL JOIN med;

-- -- b)
SELECT *
FROM laboratoire
WHERE NOT EXISTS (SELECT fonctionmedecin
                  FROM medecin
                  WHERE fonctionmedecin = 'chercheur'
                      AND laboratoire.codelaboratoire = medecin.codelaboratoire);

with md as (select NumMatricule, CodeHopital from Medecin where SpecialiteMedecin = 'gynecologie')
, hosname as (select NomHopital, NumMatricule from md natural join Hopital)
, cons as (select NumSecSoc, NomHopital from Consulter natural join hosname)
select NomPatient, PrenomPatient, NomHopital from Patient natural join cons;

SELECT *
FROM Laboratoire
WHERE CodeLaboratoire NOT IN (SELECT CodeLaboratoire
                              FROM Medecin
                              WHERE FonctionMedecin = 'chercheur');

WITH med AS (SELECT CodeLaboratoire
             FROM Medecin
             WHERE FonctionMedecin = 'chercheur'),
     lab AS (SELECT CodeLaboratoire, NomLaboratoire, CodeHopital
             FROM Laboratoire NATURAL JOIN med)
SELECT *
FROM Laboratoire
EXCEPT (SELECT * FROM lab);

med <- π[CodeLaboratoire] (σ[FonctionMedecin = 'Chercheur'] Medecin)
lab <- π[CodeLaboratoire, NomLaboratoire, CodeHopital] (Laboratoire |x| med)
π[NomLaboratoire] (Laboratoire - lab)

  WITH md AS (SELECT NumMatricule, CodeHopital FROM Medecin WHERE SpecialiteMedecin = 'gynecologie'),
       hos AS (SELECT NomHopital, NumMatricule FROM md NATURAL JOIN Hopital),
       cons AS (SELECT NumSecSoc, NomHopital FROM Consulter NATURAL JOIN hos),
       pat AS (SELECT NomPatient, PrenomPatient, NumSecSoc FROM Patient)
  SELECT NomPatient, PrenomPatient, NomHopital FROM pat NATURAL JOIN cons;
